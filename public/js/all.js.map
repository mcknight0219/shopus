{"version":3,"sources":["main.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"all.js","sourcesContent":["$(document).ready(function() {\n    $.ajaxSetup({\n        headers: { 'X-CSRF-TOKEN': $('meta[name=\"csrf_token\"]').attr('content') }\n    });\n\n    if( location.pathname === '/cms/login' || location.pathname === '/cms/register' ) { \n\n        $(\".borderedbutton\").click(function() {\n            var email = $('#email').val();\n            var pass  = $('#password').val();\n            if( !_validateEmail(email) ) {\n                $('#email').webuiPopover({\n                    content: 'Email entered is not correct',\n                    placement: 'bottom',\n                    trigger: 'manual',\n                    dismissible: true,\n                    autoHide: 2500\n                });\n                $('#email').webuiPopover('show');\n\n                return;\n            }\n\n            if( !_validatePassword(pass) ) {\n                $('#password').webuiPopover({\n                    content: 'Password must be at least six letters long and contain valid ascii letters',\n                    placement: 'bottom',\n                    trigger: 'manual',\n                    dismissible: true,\n                    autoHide: 2500\n                });\n                $('#password').webuiPopover('show');\n\n                return;\n            }\n\n            var pass2 = $('#passwordAgain').val();\n            // it's register page, check if retyped password agrees with original one\n            if( pass2 !== undefined ) {\n                if( pass !== pass2 ) {\n                    $('#passwordAgain').webuiPopover({\n                        content: 'Retyped password doesn\\'t match',\n                        placement: 'bottom',\n                        trigger: 'manual',\n                        dismissible: true,\n                        autoHide: 2500\n                    });\n                    $('#passwordAgain').webuiPopover('show');\n                    return;\n                }\n            }\n\n            $('form').submit();\n        });\n    }\n\n    // Remind user if no weixin id is associated\n    if( location.pathname === '/cms') {\n        _remindProfileEmpty();\n         // On Cms homepage, user can click to edit their profile\n        $('div#editProfile').click(function() {\n            window.location.href='/cms/profile/edit';        \n        });\n    \n        $('div#addProduct').click(function() {\n            window.location.href='/cms/product/add';\n        })\n        // Toggle fold/unfold\n        $('div#unfoldProduct').click(function() {\n            var klass = $('div#unfoldProduct > i').attr('class');\n            var dir = klass.match(/fa-chevron-(up|down)/)[1];\n            if( dir === 'up' ) {\n                klass = klass.replace(dir, 'down');\n            } else {\n                klass = klass.replace(dir, 'up');\n            }\n            $('div#unfoldProduct > i').attr('class', klass);\n        });\n    }\n\n    if( location.pathname === '/cms/profile/edit') {\n        if( $('form input[name=\"weixin\"]').val() !== \"\" ) {\n            $('form input[name=\"weixin\"]').prop('readonly', true);\n        }\n\n        // if there is default text already filled\n       ['address', 'city'].forEach(function(field) {\n            if( $('form input[name=\"' + field + '\"]').val() !== \"\" ) {\n                $('form input[name=\"' + field + '\"]').click(function() {\n                    $(this).select();\n                })\n            }\n       }); \n\n        $(\".borderedbutton\").click(function() {\n            if( $('form input[name=\"weixin\"]').val() === \"\" ) {\n                $('form input[name=\"weixin\"]').webuiPopover({\n                    content: 'Please link your Weixin ID',\n                    placement: 'bottom-right',\n                    trigger: 'manual',\n                    dismissible: true,\n                    autoHide: 4500\n                }).webuiPopover('show');\n                \n                return;\n            }\n            $('form').submit();\n        });\n    }\n\n    // First time I feel sick about jquery :(\n    if( location.pathname === '/cms/brand' ) {\n        $(document).on('click', '.title', function(e) {\n            var target = $(e.target);\n            var brandId = target.closest('.productcell').attr('data-index-number');\n            var orig = target.text();\n            target.replaceWith(function() {\n                return \"<input id=\\\"brandName\\\" class=\\\"title\\\" style=\\\"outline:none; border-width: 0 0 2px 0\\\" type=\\\"text\\\" data-source=\\\"\" + orig + \"\\\">\";\n            });\n            $('#brandName').focus();\n            $('#brandName').focusout(function() {\n                var isEmpty = $(this).val() === '';\n                var newVal = isEmpty ? $(this).attr('data-source') : $(this).val();\n                $(this).replaceWith(function() {\n                   return \"<div class=\\\"title singleline editable\\\">\" + newVal + \"</div>\";\n                });\n\n                if( !isEmpty ) {\n                    _postBrandChange(brandId, 'name', $newVal);\n                }\n            })\n        });\n\n        $(document).on('click', '.caption', function(e) {\n            var target = $(e.target);\n            var brandId = target.closest('.productcell').attr('data-index-number');\n            orig = target.text();\n            target.replaceWith(function() {\n            \treturn \"<input id=\\\"brandWebsite\\\" class=\\\"caption\\\" style=\\\"outline:none; border-width: 0 0 2px 0\\\" type=\\\"text\\\" data-source=\\\"\" + orig + \"\\\">\";\n            });\n\t\t\t$('#brandWebsite').focus();\n\t\t\t$('#brandWebsite').focusout(function() {\n                var isEmpty = $(this).val() === '';\n\t\t\t\tvar newVal = isEmpty ? $(this).attr('data-source') : $(this).val();\n\t\t\t\t$(this).replaceWith(function() {\n\t\t\t\t return \"<div class=\\\"caption singleline editable\\\">\" + newVal  + \"</div>\";\n\t\t\t\t});\n\n                if( !isEmpty ) {\n                    _postBrandChange(brandId, 'website', newVal);\n                }\n\t\t\t});\n        });\n\n        $(document).on('change', '.selector', function(e) {\n            var target = $(e.target);\n            var brandId = target.closest('.productcell').attr('data-index-number');\n            var file = new FormData();\n            if( target[0].files && target[0].files[0] ) {\n                file.append('logo', target[0].files[0]);\n                $.ajax({\n                    url: '/cms/brand/' + brandId + '/edit',\n                    type: 'POST',\n                    data: file,\n                    processData: false,\n                    contentType: false,\n                    success: function(data, textStatus, xhr) {\n                        if( xhr.status === '200') {\n                            console.log('Success');\n                        }                      \n                    }\n                });\n            }\n        });\n    }\n\n    if( location.pathname === '/cms/product/add' ) {\n        $('#fileSelector').change(function() {\n            _toggleProgressbar();\n            var file = new FormData();\n            if( $(this)[0].files &&  $(this)[0].files[0] ) {\n                var type = $('form select').val().toLowerCase();\n                file.append(type, $(this)[0].files[0]);\n                $.ajax({\n                    xhr: function() {\n                        var xhr = new window.XMLHttpRequest();\n                        xhr.upload.addEventListener('progress', function(e) {\n                            if( e.lengthComputable ) {\n                                var percent = e.loaded / e.total * 100;\n                                $('#uploadProgressbar').attr('value', percent);\n                            }\n                        }, false);\n                        \n                        return xhr;\n                    },\n                    url: '/cms/product/photo',\n                    type: 'POST',\n                    data: file,\n                    processData: false,\n                    contentType: false,\n                    success: function(response) {\n                        _toggleProgressbar();\n                        $('#fileSelector').val = \"\";\n                    },\n                    error: function(jqXHR, status, errorMessage) {\n                        console.log(errorMessage);\n                    }\n                });\n            }\n        });\n\n        $('.borderedbutton').click(function() {\n            _remindEmpty($('form input[name=\"brand\"]'), 'Brand cannot be empty') ||\n            _remindEmpty($('form input[name=\"name\"]'),  'Name cannot be empty') ||\n            _remindEmpty($('form input[name=\"price\"]'), 'Price cannot be empty') ||\n            _remindEmpty($('form textarea'), 'Description cannot be empty') || $('form').submit();\n        });\n    }\n});\n\nfunction _postBrandChange(brandId, fieldName, value) {\n    var o = {};\n    o[fieldName] = value;\n\t$.ajax({ url: '/cms/brand/' + brandId + '/edit', type: 'POST', dataType: 'text', data: o });\n}\n\nfunction _toggleProgressbar() {\n    var $selector = $('#uploadProgressbar');\n    if( $selector.attr('hidden') === undefined ) {\n        $selector.attr('hidden', true);\n    } else {\n        $selector.removeAttr('hidden');\n    }\n}\n\nfunction _validateEmail(email) {\n    var re = /^\\S+@\\S+$/;\n    return email.match(re) !== null;\n};\n\nfunction _validatePassword(pass) {\n    if( pass.length < 6 ) return false;\n    var re = /[\\x00-\\x7f]/; \n    for( var i = 0; i < pass.length; ++i ) {\n        if( !re.test(pass.charAt(i)) ) return false;\n    }\n    return true;\n};\n\nfunction _remindProfileEmpty() {\n    if( $('#profileWeixinId').text() === '' ) {\n       $('div#editProfile').webuiPopover({\n            content: 'Go here to complete your profile !',\n            placement: 'bottom',\n            trigger: 'manual',\n            dimissible: true,\n            autoHide: 4500,\n            closeable: true\n       }).webuiPopover('show'); \n    }\n};\n\nfunction _remindEmpty(selector, msg) {\n    return selector.val() === '' &&\n    selector.webuiPopover({\n        content: msg,\n        placement: 'bottom',\n        trigger: 'manual',\n        dismissible: true,\n        autoHide: 4500,\n        closeable: true\n    }).webuiPopover('show');\n}"],"sourceRoot":"/source/"}